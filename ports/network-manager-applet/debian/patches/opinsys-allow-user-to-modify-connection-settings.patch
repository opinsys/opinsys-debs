Description: Allow user to modify connection settings
Author: Veli-Matti Lintu <veli-matti.lintu@opinsys.fi>
Index: network-manager-applet/src/applet-device-wifi.c
===================================================================
--- network-manager-applet.orig/src/applet-device-wifi.c	2014-07-15 15:26:01.717485563 +0300
+++ network-manager-applet/src/applet-device-wifi.c	2014-07-15 15:26:01.713485548 +0300
@@ -547,6 +547,21 @@
 		}
 	} else {
 		/* Everything else can just get activated right away */
+
+		/* By default network-manager uses system wide permissions for all 
+		   automatically created wifi connections. This requires users to 
+		   have org.freedesktop.NetworkManager.settings.modify.system 
+		   permissions, which gives them right to modify also connections 
+		   created by other users. Here we change the connection permissions 
+		   only to the active user so that we do not need to give system 
+		   permissions to all users. By Veli-Matti Lintu / Opinsys Oy. */
+		s_con = (NMSettingConnection *) nm_setting_connection_new ();
+		uuid = nm_utils_uuid_generate ();
+		g_object_set (s_con, NM_SETTING_CONNECTION_UUID, uuid, NULL);
+		g_free (uuid);
+		nm_setting_connection_add_permission (s_con, "user", g_get_user_name (), NULL);
+		nm_connection_add_setting (connection, NM_SETTING (s_con));
+
 		callback (connection, TRUE, FALSE, callback_data);
 	}
 }
