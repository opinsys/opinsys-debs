Author: Pino Toscano <pino@debian.org>
Description: Hidden visibility for poppler-qt4 and poppler-qt5
 Enables the hidden visibility for poppler-qt4 and poppler-qt5, hiding all the
 non-exported symbols.
 .
 The addition in poppler-export.h could fit upstream, while the CXXFLAGS
 additions need to be added with proper configure check.
Forwarded: no
Last-Update: 2014-02-02

--- a/qt4/src/Makefile.am
+++ b/qt4/src/Makefile.am
@@ -56,6 +56,7 @@ libpoppler_qt4_la_SOURCES =			\
 	ArthurOutputDev.cc
 
 libpoppler_qt4_la_CXXFLAGS = 			\
+	-fvisibility=hidden -fvisibility-inlines-hidden	\
 	-Dpoppler_qt4_EXPORTS
 
 libpoppler_qt4_la_LIBADD = 			\
--- a/qt4/src/Makefile.in
+++ b/qt4/src/Makefile.in
@@ -502,6 +502,7 @@ libpoppler_qt4_la_SOURCES = \
 	ArthurOutputDev.cc
 
 libpoppler_qt4_la_CXXFLAGS = \
+	-fvisibility=hidden -fvisibility-inlines-hidden	\
 	-Dpoppler_qt4_EXPORTS
 
 libpoppler_qt4_la_LIBADD = \
--- a/qt4/src/poppler-export.h
+++ b/qt4/src/poppler-export.h
@@ -5,6 +5,9 @@
 #if defined(_WIN32)
 # define LIB_EXPORT __declspec(dllexport)
 # define LIB_IMPORT __declspec(dllimport)
+#elif defined(__GNUC__)
+# define LIB_EXPORT __attribute__((visibility("default")))
+# define LIB_IMPORT
 #else
 # define LIB_EXPORT
 # define LIB_IMPORT
--- a/qt5/src/Makefile.am
+++ b/qt5/src/Makefile.am
@@ -56,6 +56,7 @@ libpoppler_qt5_la_SOURCES =			\
 	ArthurOutputDev.cc
 
 libpoppler_qt5_la_CXXFLAGS = 			\
+	-fvisibility=hidden -fvisibility-inlines-hidden \
 	-Dpoppler_qt5_EXPORTS -fPIC
 
 libpoppler_qt5_la_LIBADD = 			\
--- a/qt5/src/Makefile.in
+++ b/qt5/src/Makefile.in
@@ -502,6 +502,7 @@ libpoppler_qt5_la_SOURCES = \
 	ArthurOutputDev.cc
 
 libpoppler_qt5_la_CXXFLAGS = \
+	-fvisibility=hidden -fvisibility-inlines-hidden \
 	-Dpoppler_qt5_EXPORTS -fPIC
 
 libpoppler_qt5_la_LIBADD = \
--- a/qt5/src/poppler-export.h
+++ b/qt5/src/poppler-export.h
@@ -5,6 +5,9 @@
 #if defined(_WIN32)
 # define LIB_EXPORT __declspec(dllexport)
 # define LIB_IMPORT __declspec(dllimport)
+#elif defined(__GNUC__)
+# define LIB_EXPORT __attribute__((visibility("default")))
+# define LIB_IMPORT
 #else
 # define LIB_EXPORT
 # define LIB_IMPORT
