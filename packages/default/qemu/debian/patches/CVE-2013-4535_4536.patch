Description: fix buffer overrun on incoming migration in virtio
Origin: upstream, http://git.qemu.org/?p=qemu.git;a=commit;h=36cf2a37132c7f01fa9adb5f95f5312b27742fd4
Origin: upstream, http://git.qemu.org/?p=qemu.git;a=commit;h=937251408051e0489f78e4db3c92e045b147b38b

Index: qemu-2.0.0+dfsg/hw/virtio/virtio.c
===================================================================
--- qemu-2.0.0+dfsg.orig/hw/virtio/virtio.c	2014-08-12 08:04:32.874479360 -0400
+++ qemu-2.0.0+dfsg/hw/virtio/virtio.c	2014-08-12 08:05:21.142480142 -0400
@@ -430,6 +430,12 @@
     unsigned int i;
     hwaddr len;
 
+    if (num_sg > VIRTQUEUE_MAX_SIZE) {
+        error_report("virtio: map attempt out of bounds: %zd > %d",
+                     num_sg, VIRTQUEUE_MAX_SIZE);
+        exit(1);
+    }
+
     for (i = 0; i < num_sg; i++) {
         len = sg[i].iov_len;
         sg[i].iov_base = cpu_physical_memory_map(addr[i], &len, is_write);
